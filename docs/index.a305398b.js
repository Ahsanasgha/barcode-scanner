!function(){
/*!
 * @georapbox/capture-photo-element
 * A custom element that implements the MediaDevices.getUserMedia() method of the MediaDevices interface to capture a photo in the browser.
 *
 * @version v1.3.0
 * @author George Raptis <georapbox@gmail.com>
 * @homepage https://github.com/georapbox/capture-photo-element#readme
 * @repository git+https://github.com/georapbox/capture-photo-element.git
 * @license MIT
 */
const t=document.createElement("template");t.innerHTML='\n  <style>\n    :host {\n      all: initial;\n      display: block;\n      box-sizing: border-box;\n    }\n    :host *,\n    :host *::before,\n    :host *::after {\n      box-sizing: inherit;\n    }\n    :host video {\n      display: block;\n    }\n    :host #output:empty {\n      display: none;\n    }\n    [hidden] {\n      display: none !important;\n    }\n  </style>\n  <video part="video" playsinline></video>\n  <canvas hidden></canvas>\n  <div part="actions-container">\n    <slot name="capture-button">\n      <button part="capture-button" type="button"><slot name="capture-button-content">Capture photo</slot></button>\n    </slot>\n    <slot name="facing-mode-button"><button part="facing-mode-button" type="button"><slot name="facing-mode-button-content">Toggle facing mode</slot></button></slot>\n  </div>\n  <div part="output-container" id="output"></div>\n';class e extends HTMLElement{connectedCallback(){if(this._canvasElement=this.shadowRoot.querySelector("canvas"),this._outputElement=this.shadowRoot.getElementById("output"),this._videoElement=this.shadowRoot.querySelector("video"),this._videoElement&&this._videoElement.addEventListener("loadedmetadata",this._onVideoLoadedMetaData),this._captureButtonSlot=this.shadowRoot.querySelector('slot[name="capture-button"]'),this._captureButtonSlot&&this._captureButtonSlot.addEventListener("slotchange",this._onCaptureButtonSlotChange),this._captureButton=this._getCaptureButton(),this._captureButton&&this._captureButton.addEventListener("click",this._onCapturePhotoButtonClick),this._facingModeButtonSlot=this.shadowRoot.querySelector('slot[name="facing-mode-button"]'),this._facingModeButtonSlot&&this._facingModeButtonSlot.addEventListener("slotchange",this._onFacingModeButtonSlotChange),this._facingModeButton=this._getFacingModeButton(),this._facingModeButton&&(this._supportedConstraints.facingMode?this._facingModeButton.addEventListener("click",this._onFacingModeButtonClick):this._facingModeButton.hidden=!0),this._upgradeProperty("outputDisabled"),this._upgradeProperty("facingMode"),this._upgradeProperty("cameraResolution"),this._upgradeProperty("zoom"),!e.isSupported())return this.dispatchEvent(new CustomEvent("capture-photo:error",{bubbles:!0,composed:!0,detail:{error:{name:"NotSupportedError",message:"Not supported"}}}));this._requestGetUserMedia()}disconnectedCallback(){this._stopVideoStreaming(),this._facingModeButton&&this._facingModeButton.removeEventListener("click",this._onFacingModeButtonClick),this._captureButton&&this._captureButton.removeEventListener("click",this._onCapturePhotoButtonClick),this._videoElement&&this._videoElement.removeEventListener("canplay",this._onVideoLoadedMetaData),this._captureButtonSlot&&this._captureButtonSlot.removeEventListener("slotchange",this._onCaptureButtonSlotChange),this._facingModeButtonSlot&&this._facingModeButtonSlot.removeEventListener("slotchange",this._onFacingModeButtonSlotChange)}attributeChangedCallback(t,e,o){"output-disabled"===t&&this._emptyOutputElement(),"facing-mode"===t&&this._supportedConstraints.facingMode&&(this._stopVideoStreaming(),this._requestGetUserMedia(),this.dispatchEvent(new CustomEvent("capture-photo:facing-mode-change",{bubbles:!0,composed:!0,detail:{facingMode:o}}))),"camera-resolution"===t&&(this._stopVideoStreaming(),this._requestGetUserMedia(),this.dispatchEvent(new CustomEvent("capture-photo:camera-resolution-change",{bubbles:!0,composed:!0,detail:{cameraResolution:o}}))),"zoom"===t&&(this._applyZoom(this.zoom),this.dispatchEvent(new CustomEvent("capture-photo:zoom-change",{bubbles:!0,composed:!0,detail:{zoom:this.zoom}})))}static get observedAttributes(){return["output-disabled","facing-mode","camera-resolution","zoom"]}get outputDisabled(){return this.hasAttribute("output-disabled")}set outputDisabled(t){t?this.setAttribute("output-disabled",""):this.removeAttribute("output-disabled")}get facingMode(){return this.getAttribute("facing-mode")}set facingMode(t){this.setAttribute("facing-mode",t)}get cameraResolution(){return this.getAttribute("camera-resolution")}set cameraResolution(t){this.setAttribute("camera-resolution",t)}get zoom(){return Number(this.getAttribute("zoom"))||null}set zoom(t){const e=Number(t)||0;this.setAttribute("zoom",e>0?Math.floor(e):0)}get loading(){return this.hasAttribute("loading")}_stopVideoStreaming(){if(!this._videoElement||!this._stream)return;const[t]=this._stream.getVideoTracks();t&&t.stop(),this._videoElement.srcObject=null,this._stream=null}_requestGetUserMedia(){if(!e.isSupported())return;this.setAttribute("loading","");const t={video:{facingMode:{ideal:this.facingMode||"user"}},audio:!1};if("string"==typeof this.cameraResolution){const[e,o]=this.cameraResolution.split("x");t.video.width=e,t.video.height=o}navigator.mediaDevices.getUserMedia(t).then((t=>{this._videoElement.srcObject=t,this._stream=t,this._applyZoom(this.zoom)})).catch((t=>{this.dispatchEvent(new CustomEvent("capture-photo:error",{bubbles:!0,composed:!0,detail:{error:t}}))})).finally((()=>{this.removeAttribute("loading")}))}capture(){if(!this.loading)try{const t=this._canvasElement.getContext("2d"),e=this._videoElement.videoWidth,o=this._videoElement.videoHeight;this._canvasElement.width=e,this._canvasElement.height=o,t.drawImage(this._videoElement,0,0,e,o);const n=this._canvasElement.toDataURL("image/png");if("string"==typeof n&&n.includes("data:image")){if(!this.outputDisabled){const t=new Image;t.src=n,t.width=e,t.height=o,t.part="output-image",this._emptyOutputElement(),this._outputElement&&this._outputElement.appendChild(t)}this.dispatchEvent(new CustomEvent("capture-photo:success",{bubbles:!0,composed:!0,detail:{dataURI:n,width:e,height:o}}))}}catch(t){this.dispatchEvent(new CustomEvent("capture-photo:error",{bubbles:!0,composed:!0,detail:{error:t}}))}}_onFacingModeButtonClick(t){t.preventDefault(),this.loading||(this.facingMode="user"!==this.facingMode&&this.facingMode?"user":"environment")}_onCapturePhotoButtonClick(t){t.preventDefault(),this.capture()}_onVideoLoadedMetaData(t){const e=t.target;e.play().then((()=>{this.dispatchEvent(new CustomEvent("capture-photo:video-play",{bubbles:!0,composed:!0,detail:{video:e}}))})).catch((t=>{this.dispatchEvent(new CustomEvent("capture-photo:error",{bubbles:!0,composed:!0,detail:{error:t}}))})).finally((()=>{this.removeAttribute("loading")}))}_emptyOutputElement(){this._outputElement&&Array.from(this._outputElement.childNodes).forEach((t=>t.remove()))}_applyZoom(t){if(!this._stream||!t)return;const[e]=this._stream.getVideoTracks();if("function"!=typeof e.getCapabilities||"function"!=typeof e.getSettings)return;const o=e.getCapabilities();var n,i,a;"zoom"in e.getSettings()&&e.applyConstraints({advanced:[{zoom:(n=Number(t),i=o.zoom.min,a=o.zoom.max,Number.isNaN(i)&&(i=0),Number.isNaN(a)&&(a=0),Math.min(Math.max(n,Math.min(i,a)),Math.max(i,a)))}]})}_onCaptureButtonSlotChange(t){t.target&&"capture-button"===t.target.name&&(this._captureButton&&this._captureButton.removeEventListener("click",this._onCapturePhotoButtonClick),this._captureButton=this._getCaptureButton(),this._captureButton&&(this._captureButton.addEventListener("click",this._onCapturePhotoButtonClick),"BUTTON"===this._captureButton.nodeName||this._captureButton.hasAttribute("role")||this._captureButton.setAttribute("role","button")))}_onFacingModeButtonSlotChange(t){t.target&&"facing-mode-button"===t.target.name&&(this._facingModeButton&&this._facingModeButton.removeEventListener("click",this._onFacingModeButtonClick),this._facingModeButton=this._getFacingModeButton(),this._facingModeButton&&(this._facingModeButton.addEventListener("click",this._onFacingModeButtonClick),"BUTTON"===this._facingModeButton.nodeName||this._facingModeButton.hasAttribute("role")||this._facingModeButton.setAttribute("role","button")))}_getFacingModeButton(){return this._facingModeButtonSlot?this._facingModeButtonSlot.assignedElements({flatten:!0}).find((t=>"BUTTON"===t.nodeName||"facing-mode-button"===t.getAttribute("slot"))):null}_getCaptureButton(){return this._captureButtonSlot?this._captureButtonSlot.assignedElements({flatten:!0}).find((t=>"BUTTON"===t.nodeName||"capture-button"===t.getAttribute("slot"))):null}_upgradeProperty(t){if(Object.prototype.hasOwnProperty.call(this,t)){const e=this[t];delete this[t],this[t]=e}}static isSupported(){return Boolean(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}static defineCustomElement(t="capture-photo"){"undefined"==typeof window||window.customElements.get(t)||window.customElements.define(t,e)}constructor(){super(),this._supportedConstraints=e.isSupported()?navigator.mediaDevices.getSupportedConstraints():{},this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t.content.cloneNode(!0))),this._onFacingModeButtonClick=this._onFacingModeButtonClick.bind(this),this._onCapturePhotoButtonClick=this._onCapturePhotoButtonClick.bind(this),this._onVideoLoadedMetaData=this._onVideoLoadedMetaData.bind(this),this._onCaptureButtonSlotChange=this._onCaptureButtonSlotChange.bind(this),this._onFacingModeButtonSlotChange=this._onFacingModeButtonSlotChange.bind(this)}}!async function(){const t=document.querySelector("capture-photo"),o=document.getElementById("results"),n=document.querySelector(".scanning"),i=document.getElementById("scanBtn"),a=document.getElementById("error");let s,r=!1;if(!("BarcodeDetector"in window))return t.hidden=!0,void(a.textContent="BarcodeDetector API is not supported by your browser.");document.addEventListener("capture-photo:error",(e=>{t.hidden=!0,a.textContent=e.detail.error.message})),t.addEventListener("capture-photo:video-play",(()=>{r||(n.hidden=!1,c()),r=!0})),e.defineCustomElement();const u=t.shadowRoot.querySelector("video"),d=new window.BarcodeDetector({formats:await window.BarcodeDetector.getSupportedFormats()});async function c(){try{const t=d.detect(u),e=await t;if(Array.isArray(e)&&e.length>0)return window.cancelAnimationFrame(s),function(t){const e=document.createElement("div");e.className="results__item";try{new URL(t);const o=document.createElement("a");o.href=t,o.setAttribute("target","_blank"),o.setAttribute("rel","noreferrer noopener"),o.textContent=t,e.appendChild(o)}catch(t){}const n=document.createElement("span");n.textContent=t,e.appendChild(n),o.appendChild(e)}(e[0].rawValue),n.hidden=!0,i.hidden=!1,void(o.hidden=!1)}catch(t){}s=window.requestAnimationFrame(c)}i.addEventListener("click",(()=>{n.hidden=!1,i.hidden=!0,o.hidden=!0,o.querySelectorAll(".results__item").forEach((t=>t.remove())),c()}))}()}();
//# sourceMappingURL=index.a305398b.js.map
